<!DOCTYPE html>
<html>
  <body>

    <div class="header-info">
      <span class="title" id="title">Configurar Webhook</span>
      <span id="subtitle">Insira a URL de destino</span>
    </div>

    <div class="action-container">
      <input id="urlInput" type="text" class="input" placeholder="https://seu-endpoint.com/webhook">
      <button id="actionButton">Salvar URL</button>

      <button id="changeUrlButton" style="display:none; background:#555;">
        Alterar URL
      </button>

      <div id="loading" style="display:none; text-align:center;">
        Enviando...
      </div>
    </div>

    <style>
      body { display:flex; flex-direction:column; font-family:"Noto Sans JP", sans-serif; }
      .title { font-size: 20px; font-weight: 600; }
      .header-info { display:flex; flex-direction:column; gap:10px; align-items:center; margin-bottom:20px; }
      .action-container { display:flex; flex-direction:column; gap:10px; }
      input { padding:10px; border:2px solid #ccc; border-radius:10px; font-size:16px; color:#555; outline:none; }
      button { height:40px; border-radius:10px; background:#007bff; color:white; border:none; cursor:pointer; }
      button:disabled { background:#7aaef5; }
    </style>

    <script>
      const titleEl = document.getElementById("title");
      const subtitleEl = document.getElementById("subtitle");
      const buttonEl = document.getElementById("actionButton");
      const changeUrlBtn = document.getElementById("changeUrlButton");
      const urlInput = document.getElementById("urlInput");
      const loadingEl = document.getElementById("loading");

      // Default: save URL
      function setSaveUrlMode() {
        titleEl.textContent = "Configurar Webhook";
        subtitleEl.textContent = "Insira a URL de destino";

        urlInput.style.display = "block";
        buttonEl.textContent = "Salvar URL";
        changeUrlBtn.style.display = "none";

        buttonEl.onclick = () => {
          parent.postMessage({
            pluginMessage: {
              type: "set-url",
              url: urlInput.value
            }
          }, "*");
        };
      }

      // Sending mode
      function setSendMode(savedUrl) {
        titleEl.textContent = "Selecione um frame";
        subtitleEl.textContent = "Depois clique para enviar";

        if (savedUrl) urlInput.value = savedUrl;

        urlInput.style.display = "none";
        buttonEl.textContent = "Enviar imagem";
        changeUrlBtn.style.display = "block";

        buttonEl.onclick = () => {
          loadingEl.style.display = "block";
          buttonEl.disabled = true;

          parent.postMessage({ pluginMessage: { type: "send" } }, "*");
        };
      }

      // change URL button
      changeUrlBtn.onclick = () => {
        setSaveUrlMode();
      };

      // Messages from backend
      window.onmessage = (event) => {
        const msg = event.data.pluginMessage;

        if (msg.type === "logged-in") {
          setSendMode(msg.webhookUrl);
        }

        if (msg.type === "send-success" || msg.type === "send-failed") {
          loadingEl.style.display = "none";
          buttonEl.disabled = false;
        }
      };

      // Start in "save url" mode
      setSaveUrlMode();
    </script>
  </body>
</html>
